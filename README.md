Tea Factory Simulator - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ
üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
TeaFactorySimulator/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îî‚îÄ‚îÄ com/
‚îÇ       ‚îî‚îÄ‚îÄ teafactory/
‚îÇ           ‚îú‚îÄ‚îÄ Main.java
‚îÇ           ‚îú‚îÄ‚îÄ model/
‚îÇ           ‚îÇ   ‚îú‚îÄ‚îÄ TeaType.java
‚îÇ           ‚îÇ   ‚îî‚îÄ‚îÄ TeaBatch.java
‚îÇ           ‚îú‚îÄ‚îÄ buffer/
‚îÇ           ‚îÇ   ‚îî‚îÄ‚îÄ TeaBuffer.java
‚îÇ           ‚îú‚îÄ‚îÄ workers/
‚îÇ           ‚îÇ   ‚îú‚îÄ‚îÄ RawSupplier.java
‚îÇ           ‚îÇ   ‚îú‚îÄ‚îÄ TeaMaster.java
‚îÇ           ‚îÇ   ‚îú‚îÄ‚îÄ Packer.java
‚îÇ           ‚îÇ   ‚îî‚îÄ‚îÄ Buyer.java
‚îÇ           ‚îú‚îÄ‚îÄ core/
‚îÇ           ‚îÇ   ‚îî‚îÄ‚îÄ TeaFactory.java
‚îÇ           ‚îî‚îÄ‚îÄ gui/
‚îÇ               ‚îî‚îÄ‚îÄ FactoryGUI.java
‚îî‚îÄ‚îÄ README.md
üîß –ö–æ–º–ø–∏–ª—è—Ü–∏—è –∏ –∑–∞–ø—É—Å–∫
–í–∞—Ä–∏–∞–Ω—Ç 1: –ö–æ–º–∞–Ω–¥–Ω–∞—è —Å—Ç—Ä–æ–∫–∞
bash# –ö–æ–º–ø–∏–ª—è—Ü–∏—è
javac -d bin -sourcepath src src/com/teafactory/Main.java

# –ó–∞–ø—É—Å–∫
java -cp bin com.teafactory.Main
–í–∞—Ä–∏–∞–Ω—Ç 2: IntelliJ IDEA

File ‚Üí New ‚Üí Project from Existing Sources
–í—ã–±–µ—Ä–∏—Ç–µ –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞
–£–∫–∞–∂–∏—Ç–µ src –∫–∞–∫ Source Root
Run ‚Üí Run 'Main'

–í–∞—Ä–∏–∞–Ω—Ç 3: Eclipse

File ‚Üí Import ‚Üí Existing Projects into Workspace
–í—ã–±–µ—Ä–∏—Ç–µ –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞
Right-click –Ω–∞ Main.java ‚Üí Run As ‚Üí Java Application

üéØ –ö–ª—é—á–µ–≤—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ –¥–ª—è –∑–∞—â–∏—Ç—ã
1. Phaser –∏ —Ñ–∞–∑—ã –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞
–í–æ–ø—Ä–æ—Å: –ó–∞—á–µ–º –Ω—É–∂–µ–Ω Phaser –∏ –∫–∞–∫ –æ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç?
–û—Ç–≤–µ—Ç: Phaser —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç –ø–æ—Ç–æ–∫–∏ –ø–æ —Ñ–∞–∑–∞–º. –£ –Ω–∞—Å 4 —Ñ–∞–∑—ã:

–§–∞–∑–∞ 0 (SUPPLY): –ø–æ—Å—Ç–∞–≤—â–∏–∫ –∫–ª–∞–¥—ë—Ç —Å—ã—Ä—å—ë
–§–∞–∑–∞ 1 (PROCESS): –º–∞—Å—Ç–µ—Ä –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç
–§–∞–∑–∞ 2 (PACK): —Ñ–∞—Å–æ–≤—â–∏–∫ —É–ø–∞–∫–æ–≤—ã–≤–∞–µ—Ç
–§–∞–∑–∞ 3 (CONSUME): –ø–æ–∫—É–ø–∞—Ç–µ–ª–∏ –±–µ—Ä—É—Ç —Ç–æ–≤–∞—Ä

–ö–∞–∂–¥—ã–π –ø–æ—Ç–æ–∫ –≤—ã–∑—ã–≤–∞–µ—Ç arriveAndAwaitAdvance() ‚Äî —ç—Ç–æ –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø–æ—Ç–æ–∫ –¥–æ —Ç–µ—Ö –ø–æ—Ä, –ø–æ–∫–∞ –í–°–ï –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ—Ç–æ–∫–∏ –Ω–µ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç —ç—Ç–æ–π —Ç–æ—á–∫–∏. –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ Phaser –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –∫ —Å–ª–µ–¥—É—é—â–µ–π —Ñ–∞–∑–µ.
–í–∞–∂–Ω–æ: –ü–æ—Ç–æ–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç —Ç–æ–ª—å–∫–æ –≤ —Å–≤–æ–µ–π —Ñ–∞–∑–µ, –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø—Ä–æ—Å—Ç–æ –∂–¥—É—Ç.
2. ReentrantLock vs synchronized
–í–æ–ø—Ä–æ—Å: –ü–æ—á–µ–º—É –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ synchronized?
–û—Ç–≤–µ—Ç:

synchronized ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π, –Ω–æ –º–µ–Ω–µ–µ –≥–∏–±–∫–∏–π
ReentrantLock + Condition –¥–∞—ë—Ç —Ç–æ—á–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å:

notEmpty.await() ‚Äî –∂–¥–∞—Ç—å, –ø–æ–∫–∞ –±—É—Ñ–µ—Ä –Ω–µ –ø—É—Å—Ç–æ–π
notFull.await() ‚Äî –∂–¥–∞—Ç—å, –ø–æ–∫–∞ –±—É—Ñ–µ—Ä –Ω–µ –ø–æ–ª–Ω—ã–π
signal() ‚Äî —Ä–∞–∑–±—É–¥–∏—Ç—å –æ–¥–∏–Ω –∂–¥—É—â–∏–π –ø–æ—Ç–æ–∫
lock.unlock() –≤ finally ‚Äî –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ



3. Condition –∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ—Ç–æ–∫–æ–≤
–í–æ–ø—Ä–æ—Å: –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø—Ä–∏ –ø—É—Å—Ç–æ–º –±—É—Ñ–µ—Ä–µ?
–û—Ç–≤–µ—Ç: –í –º–µ—Ç–æ–¥–µ take():
javalock.lock();
try {
    while (deque.isEmpty()) {
        notEmpty.await(); // –û—Å–≤–æ–±–æ–∂–¥–∞–µ–º lock –∏ –∂–¥—ë–º
    }
    // ... –±–µ—Ä—ë–º —ç–ª–µ–º–µ–Ω—Ç ...
    notFull.signal(); // –ë—É–¥–∏–º —Ç–µ—Ö, –∫—Ç–æ –∂–¥–∞–ª –º–µ—Å—Ç–∞
} finally {
    lock.unlock();
}
await() –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç lock –∏ —É—Å—ã–ø–ª—è–µ—Ç –ø–æ—Ç–æ–∫. –ö–æ–≥–¥–∞ –¥—Ä—É–≥–æ–π –ø–æ—Ç–æ–∫ –≤—ã–∑–æ–≤–µ—Ç signal(), –ø–æ—Ç–æ–∫ –ø—Ä–æ—Å–Ω—ë—Ç—Å—è –∏ —Å–Ω–æ–≤–∞ –∑–∞—Ö–≤–∞—Ç–∏—Ç lock.
4. –ü–æ—á–µ–º—É while, –∞ –Ω–µ if?
–í–æ–ø—Ä–æ—Å: –ó–∞—á–µ–º while (deque.isEmpty())?
–û—Ç–≤–µ—Ç: –ó–∞—â–∏—Ç–∞ –æ—Ç spurious wakeups (–ª–æ–∂–Ω—ã—Ö –ø—Ä–æ–±—É–∂–¥–µ–Ω–∏–π). –ü–æ—Ç–æ–∫ –º–æ–∂–µ—Ç –ø—Ä–æ—Å–Ω—É—Ç—å—Å—è –±–µ–∑ signal(). while –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –º—ã –ø—Ä–æ–≤–µ—Ä–∏–º —É—Å–ª–æ–≤–∏–µ –ø–æ–≤—Ç–æ—Ä–Ω–æ.
5. –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø–æ—Ç–æ–∫–æ–≤
–í–æ–ø—Ä–æ—Å: –ö–∞–∫ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–æ—Ç–æ–∫–∏?
–û—Ç–≤–µ—Ç:

–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º running = false
–í—ã–∑—ã–≤–∞–µ–º thread.interrupt() (–¥–ª—è –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è sleep –∏ await)
–ü–æ—Ç–æ–∫–∏ –∑–∞–≤–µ—Ä—à–∞—é—Ç—Å—è –≤ –±–ª–æ–∫–µ finally —Å phaser.arriveAndDeregister()

6. –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–∞—à–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å: –∫–∞–∂–¥—ã–π –∫–ª–∞—Å—Å ‚Äî –æ—Ç–¥–µ–ª—å–Ω–∞—è –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç—å
–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å: –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ —Ç–∏–ø—ã —Ä–∞–±–æ—á–∏—Ö
–û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å: –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ InterruptedException
–ù–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å: –ª–æ–≥ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –º–µ—Ç–∫–∞–º–∏

üêõ –í–æ–∑–º–æ–∂–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã –∏ –ø—Ä–æ–±–ª–µ–º—ã
Q: –ß—Ç–æ –µ—Å–ª–∏ –±—É—Ñ–µ—Ä –ø–µ—Ä–µ–ø–æ–ª–Ω–∏—Ç—Å—è?
A: –ü–æ—Ç–æ–∫, –≤—ã–∑–≤–∞–≤—à–∏–π put(), –∑–∞–±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –Ω–∞ notFull.await() –¥–æ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è –º–µ—Å—Ç–∞.
Q: Deadlock –≤–æ–∑–º–æ–∂–µ–Ω?
A: –ù–µ—Ç, –ø–æ—Ç–æ–º—É —á—Ç–æ:

–ö–∞–∂–¥—ã–π lock –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç—Å—è –≤ finally
Phaser —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç —Ñ–∞–∑—ã
–ù–µ—Ç —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –º–µ–∂–¥—É lock'–∞–º–∏

Q: –ó–∞—á–µ–º 3 –ø–æ–∫—É–ø–∞—Ç–µ–ª—è?
A: –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏–∏ –∑–∞ —Ä–µ—Å—É—Ä—Å (readyBuffer). –ü–æ–∫—É–ø–∞—Ç–µ–ª–∏ –∫–æ–Ω–∫—É—Ä–∏—Ä—É—é—Ç –∑–∞ –≥–æ—Ç–æ–≤—ã–π —á–∞–π.
Q: –ú–æ–∂–Ω–æ –ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å —Ä–∞–∑–º–µ—Ä—ã –±—É—Ñ–µ—Ä–æ–≤?
A: –î–∞, –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ TeaFactory:
javathis.rawBuffer = new TeaBuffer(10, "RawBuffer"); // –±—ã–ª–æ 5
üìä –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã

–ù–∞–∂–º–∏—Ç–µ Start
–ù–∞–±–ª—é–¥–∞–π—Ç–µ –∑–∞:

–ü–µ—Ä–µ—Ö–æ–¥–æ–º —Ñ–∞–∑ (–∫–∞–∂–¥—ã–µ 4-6 —Å–µ–∫—É–Ω–¥)
–ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ–º/–æ–ø—É—Å—Ç–æ—à–µ–Ω–∏–µ–º –±—É—Ñ–µ—Ä–æ–≤
–õ–æ–≥–æ–º –æ–ø–µ—Ä–∞—Ü–∏–π


–ù–∞–∂–º–∏—Ç–µ Stop –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

üí° –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (–µ—Å–ª–∏ —Å–ø—Ä–æ—Å—è—Ç)

–î–æ–±–∞–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É: –ø–æ–¥—Å—á—ë—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –ø–∞—Ä—Ç–∏–π
–ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏: –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–∞—Ä—Ç–∏–∏
–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã: –ø–æ–∫—É–ø–∞—Ç–µ–ª–∏ VIP —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º
–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Ñ–∞–π–ª: —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏

‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –∑–∞—â–∏—Ç–æ–π

 –ü—Ä–æ–µ–∫—Ç –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
 GUI –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
 –ü–æ–Ω–∏–º–∞—é —Ä–æ–ª—å Phaser
 –ü–æ–Ω–∏–º–∞—é —Ä–∞–∑–Ω–∏—Ü—É Lock vs synchronized
 –ú–æ–≥—É –æ–±—ä—è—Å–Ω–∏—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫—É —á–µ—Ä–µ–∑ Condition
 –ó–Ω–∞—é, –∑–∞—á–µ–º while –≤–º–µ—Å—Ç–æ if
 –ú–æ–≥—É –ø–æ–∫–∞–∑–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø–æ—Ç–æ–∫–æ–≤

üéì –ö–ª—é—á–µ–≤—ã–µ —Ç–µ—Ä–º–∏–Ω—ã

Phaser ‚Äî –±–∞—Ä—å–µ—Ä —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –¥–ª—è —Ñ–∞–∑
ReentrantLock ‚Äî —è–≤–Ω—ã–π lock —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∑–∞—Ö–≤–∞—Ç–∞
Condition ‚Äî –æ—á–µ—Ä–µ–¥—å –æ–∂–∏–¥–∞–Ω–∏—è –¥–ª—è –ø–æ—Ç–æ–∫–æ–≤
Producer-Consumer ‚Äî –ø–∞—Ç—Ç–µ—Ä–Ω –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å-–ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å
Thread-safe ‚Äî –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
Spurious wakeup ‚Äî –ª–æ–∂–Ω–æ–µ –ø—Ä–æ–±—É–∂–¥–µ–Ω–∏–µ –ø–æ—Ç–æ–∫–∞


–£–¥–∞—á–∏ –Ω–∞ –∑–∞—â–∏—Ç–µ! üçµ
